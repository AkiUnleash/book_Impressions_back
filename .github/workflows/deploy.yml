name: deploy
on: push
jobs:
  integration:
    name: Integration test
    runs-on: ubuntu-latest
    steps:

    - name: Install dependencies
      run: |
        apt update
        apt install -yV build-essential

    - name: Checkout code
      uses: actions/checkout@v2

    - name: Setup for integration test
      run: sudo npm install -g newman

    - name: Build the docker-compose stack # Docker Composeを実行
      run: docker-compose -f docker-compose.yml up -d

    - name: Sleep to wait for preparing of containers
      run: sleep 30 # ポイント③
    
    # - name: http
    #   run: curl 'http://localhost:8082/api/account/nowuser'

    # - name: https
    #   run: curl 'https://localhost:8083/api/account/nowuser'

    - name: TEST RUN
      run: newman run ./tests/SRB_Auto.postman_collection.json --insecure 